<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第一个云函数 | 云叩</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="低代码平台">
    
    <link rel="preload" href="/cloudcode-doc/assets/css/0.styles.6c276a56.css" as="style"><link rel="preload" href="/cloudcode-doc/assets/js/app.f064c89d.js" as="script"><link rel="preload" href="/cloudcode-doc/assets/js/2.6733995e.js" as="script"><link rel="preload" href="/cloudcode-doc/assets/js/9.6fdee173.js" as="script"><link rel="prefetch" href="/cloudcode-doc/assets/js/10.8da09727.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/11.93e30008.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/12.8efe4ea1.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/13.31aced21.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/14.98cae4a0.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/15.864c441e.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/16.a0503a4f.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/17.ca48116a.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/18.5b101f25.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/19.1187d1c8.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/20.3fb2b672.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/21.1f624041.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/3.a73aa29d.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/5.fc791712.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/7.4bcf017a.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/8.74d77c1e.js">
    <link rel="stylesheet" href="/cloudcode-doc/assets/css/0.styles.6c276a56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cloudcode-doc/" class="home-link router-link-active"><img src="/cloudcode-doc/logo.png" alt="云叩" class="logo"> <span class="site-name can-hide">云叩</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cloudcode-doc/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/cloudcode-doc/server-side/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/cloudcode-doc/cloud-dev/" class="nav-link router-link-active">
  云开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/lowcode/" class="nav-link">
  低代码
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cloudcode-doc/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/cloudcode-doc/server-side/" class="nav-link">
  服务端
</a></div><div class="nav-item"><a href="/cloudcode-doc/cloud-dev/" class="nav-link router-link-active">
  云开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/lowcode/" class="nav-link">
  低代码
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloudcode-doc/cloud-dev/" aria-current="page" class="sidebar-link">云开发介绍</a></li><li><a href="/cloudcode-doc/cloud-dev/first_function.html" aria-current="page" class="active sidebar-link">第一个云函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/first_function.html#参数说明" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/first_function.html#使用云函数" class="sidebar-link">使用云函数</a></li></ul></li><li><a href="/cloudcode-doc/cloud-dev/func_environment.html" class="sidebar-link">云函数环境</a></li><li><a href="/cloudcode-doc/cloud-dev/use_sdk.html" class="sidebar-link">使用云函数SDK</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第一个云函数"><a href="#第一个云函数" class="header-anchor">#</a> 第一个云函数</h1> <ol><li>在cloudfunctions目录下新建一个云函数目录，名为add</li> <li>在add目录下使用<code>npm init</code>初始化npm</li> <li>在add目录下新建一个js文件，名为<code>index.js</code></li> <li>在<code>index.js</code>文件中编写如下内容</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// event用于接收事件参数，类型是个Buffer</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">.</span>args<span class="token punctuation">;</span> <span class="token comment">// event.args 用于接收传给云函数的参数，是个对象</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过callback将结果返回，第一个参数是Error，第二个参数是返回的结果</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h2> <ul><li>event参数<br>
用于传递参数。其是一个Buffer，可以将其转成JSON后使用。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
    args<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 用户传入的参数</span>
    userInfo<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>  <span class="token comment">// 函数调用者的用户信息</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>context参数<br>
context参数主要包含一些函数的运行信息。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    requestId<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token comment">// 本次调用请求的唯一ID，您可以把它记录下来在出现问题的时候方便查询</span>
    <span class="token keyword">function</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 当前调用的函数的一些基本信息，例如函数名、函数入口、函数内存和超时时间。</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>callback函数<br>
callback是由系统定义的函数，作为入口函数的入参用于返回调用函数的结果，标识函数执行结束。其签名是function(err, data)，与Node.js中使用的callback一样，它的第一个参数是error，第二个参数data。</p> <ul><li><p>如果调用时error不为空，则函数返回HandledInvocationError，否则返回data的内容。</p></li> <li><p>如果data是Buffer类型，则它的数据将直接被返回。</p></li> <li><p>如果data是object，则会将其转换成JSON字符串返回。</p></li> <li><p>如果data是其他类型将被转换成字符串返回。</p></li></ul></li></ul> <h2 id="使用云函数"><a href="#使用云函数" class="header-anchor">#</a> 使用云函数</h2> <h4 id="使用docker在本地调试云函数"><a href="#使用docker在本地调试云函数" class="header-anchor">#</a> 使用Docker在本地调试云函数</h4> <p>在本地为了方便开发者调试，我们使用Docker模拟了线上的serverless环境，其中包含云函数、云数据库和云存储的运行环境。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker pull registry.cn-hangzhou.aliyuncs.com/musii/cc-serverless-sandbox:latest <span class="token comment"># 拉取镜像</span>
docker run -itd -p <span class="token number">3000</span>:3000 -v 云函数代码绝对路径:/var/fc/runtime/nodejs12/code registry.cn-hangzhou.aliyuncs.com/musii/cc-serverless-sandbox:latest <span class="token comment"># 运行docker</span>
</code></pre></div><p>在前端项目中指定<code>window.FC_ENV = 'dev'</code>即可使用本地的环境</p> <h4 id="部署到云函数"><a href="#部署到云函数" class="header-anchor">#</a> 部署到云函数</h4> <p>当本地调试完成后就可以部署到云函数上使用了，首先将云函数压缩(需要包含<code>node_modules</code>目录)成zip压缩包，在云叩平台上传即可。
<img src="/cloudcode-doc/images/deploy_function.png" alt="deploy_function"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">11/9/2021, 5:38:39 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloudcode-doc/cloud-dev/" class="prev router-link-active">
        云开发介绍
      </a></span> <span class="next"><a href="/cloudcode-doc/cloud-dev/func_environment.html">
        云函数环境
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/cloudcode-doc/assets/js/app.f064c89d.js" defer></script><script src="/cloudcode-doc/assets/js/2.6733995e.js" defer></script><script src="/cloudcode-doc/assets/js/9.6fdee173.js" defer></script>
  </body>
</html>
