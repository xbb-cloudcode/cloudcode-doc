<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>云函数环境 | 云叩</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="低代码平台">
    
    <link rel="preload" href="/cloudcode-doc/assets/css/0.styles.4a874975.css" as="style"><link rel="preload" href="/cloudcode-doc/assets/js/app.28b4bf40.js" as="script"><link rel="preload" href="/cloudcode-doc/assets/js/2.81338d90.js" as="script"><link rel="preload" href="/cloudcode-doc/assets/js/14.95054a19.js" as="script"><link rel="prefetch" href="/cloudcode-doc/assets/js/10.06c3f234.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/11.2311605c.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/12.4732684e.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/13.88c51bc3.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/15.13a258c6.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/16.6afac3b1.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/17.7885843b.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/18.86fa3fcd.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/19.c5cd5831.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/20.3ad7313a.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/21.6f6f7369.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/22.12ab103e.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/23.a6dd7924.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/24.1bb5890d.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/25.2c35e9fa.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/26.af2d8b4e.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/27.d471ac44.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/28.f3d86ea4.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/29.698e7dd6.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/3.14f8edbb.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/30.9e5f7d55.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/4.6aabe065.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/5.9bb9d1d8.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/6.b20a9866.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/7.36cf9456.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/8.407da3ca.js"><link rel="prefetch" href="/cloudcode-doc/assets/js/9.0c9c3119.js">
    <link rel="stylesheet" href="/cloudcode-doc/assets/css/0.styles.4a874975.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cloudcode-doc/" class="home-link router-link-active"><img src="/cloudcode-doc/logo.png" alt="云叩" class="logo"> <span class="site-name can-hide">云叩</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cloudcode-doc/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/cloudcode-doc/plugin/" class="nav-link">
  插件开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/lowcode/" class="nav-link">
  低代码
</a></div><div class="nav-item"><a href="/cloudcode-doc/cloud-dev/" class="nav-link router-link-active">
  云开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/devtool/" class="nav-link">
  工具
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cloudcode-doc/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/cloudcode-doc/plugin/" class="nav-link">
  插件开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/lowcode/" class="nav-link">
  低代码
</a></div><div class="nav-item"><a href="/cloudcode-doc/cloud-dev/" class="nav-link router-link-active">
  云开发
</a></div><div class="nav-item"><a href="/cloudcode-doc/devtool/" class="nav-link">
  工具
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cloudcode-doc/cloud-dev/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/cloudcode-doc/cloud-dev/func_environment.html" aria-current="page" class="active sidebar-link">云函数环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/func_environment.html#返回信息" class="sidebar-link">返回信息</a></li><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/func_environment.html#使用内置模块" class="sidebar-link">使用内置模块</a></li><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/func_environment.html#使用自定义模块" class="sidebar-link">使用自定义模块</a></li><li class="sidebar-sub-header"><a href="/cloudcode-doc/cloud-dev/func_environment.html#调用外部命令" class="sidebar-link">调用外部命令</a></li></ul></li><li><a href="/cloudcode-doc/cloud-dev/first_function.html" class="sidebar-link">第一个云函数</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="云函数环境"><a href="#云函数环境" class="header-anchor">#</a> 云函数环境</h1> <blockquote><p>云函数是运行在阿里云函数计算服务上的，目前仅支持nodejs12(Node.js 12.16.1)的运行环境。</p></blockquote> <h2 id="返回信息"><a href="#返回信息" class="header-anchor">#</a> 返回信息</h2> <p>Node.js采用异步编程的模型，您的函数需要使用callback入参返回信息。callback的语法如下所示。
<code>callback(Error error, Object result);</code></p> <table><thead><tr><th>参数名称</th> <th>说明</th></tr></thead> <tbody><tr><td>error</td> <td>在函数执行内部失败时使用此参数返回错误内容，成功情况下设置为null。</td></tr> <tr><td>result</td> <td>使用此参数返回函数成功的执行结果。result可以是任意类型，函数计算会将其序列化成字节流，放到响应体中返回给调用方。</td></tr></tbody></table> <ul><li>callback被调用后则函数结束
callback被调用后函数就会停止运行，重复调用callback只接受第一次调用的结果。需要确保所有任务在callback调用之前完成，否则有些任务可能不会被运行。例如调用下面的函数，将返回hello world，并且message不会被打印。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>     
</code></pre></div><ul><li>callback未被调用则函数超时
如果在函数中没有调用callback，则系统将认为函数没有结束，会等待函数结果直到超时。</li></ul> <h2 id="使用内置模块"><a href="#使用内置模块" class="header-anchor">#</a> 使用内置模块</h2> <p>除了Node.js的标准模块，函数计算的Node.js运行环境中还包含了一些常用模块，您可以直接引用这些常用模块，目前函数计算包含的常见模块如下所示。</p> <table><thead><tr><th>名称</th> <th>版本</th> <th>模块介绍</th></tr></thead> <tbody><tr><td>co</td> <td>4.6.0</td> <td>控制流</td></tr> <tr><td>gm</td> <td>1.23.0</td> <td>图片处理库</td></tr> <tr><td>ali-oss</td> <td>4.10.1</td> <td>OSS SDK</td></tr> <tr><td>ali-mns</td> <td>2.6.5</td> <td>MNS SDK</td></tr> <tr><td>tablestore</td> <td>4.2.0</td> <td>OTS SDK</td></tr> <tr><td>aliyun-sdk</td> <td>1.10.12</td> <td>Aliyun SDK</td></tr> <tr><td>opencv</td> <td>6.0.0</td> <td>视觉算法库</td></tr></tbody></table> <h2 id="使用自定义模块"><a href="#使用自定义模块" class="header-anchor">#</a> 使用自定义模块</h2> <p>如果您需要使用自定义模块，则需要将您的自定义模块与代码一起打包上传。您可以使用npm包管理器进行依赖管理。打包时，需要针对文件进行打包，而不是针对代码整体目录进行打包。打包完成后，入口函数(index.js)文件需要位于包内的根目录。</p> <ul><li>在Windows下打包时，可以进入函数代码目录，全选所有文件以后，单击鼠标右键，选择压缩为zip包，生成代码包。</li> <li>在Linux下打包时，通过调用zip命令时，将源文件指定为代码目录下的所有文件，实现生成部署代码包，例如zip code.zip /home/code/*。</li></ul> <h2 id="调用外部命令"><a href="#调用外部命令" class="header-anchor">#</a> 调用外部命令</h2> <p>您的函数可能会用到一些工具，而这些工具并不是用Node.js写的。例如，Shell、C++ 或者Go编译出来的可执行文件。您仍然可以将这些工具与代码一起打包，然后在函数中通过运行外部命令的方法来使用它们。以下代码演示了如何运行一个Shell脚本。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scriptPath <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'FC_FUNC_CODE_PATH'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/script.sh'</span><span class="token punctuation">;</span>
  exec<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'bash '</span><span class="token operator">+</span>scriptPath<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">9/14/2022, 7:06:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloudcode-doc/cloud-dev/" class="prev router-link-active">
        介绍
      </a></span> <span class="next"><a href="/cloudcode-doc/cloud-dev/first_function.html">
        第一个云函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/cloudcode-doc/assets/js/app.28b4bf40.js" defer></script><script src="/cloudcode-doc/assets/js/2.81338d90.js" defer></script><script src="/cloudcode-doc/assets/js/14.95054a19.js" defer></script>
  </body>
</html>
