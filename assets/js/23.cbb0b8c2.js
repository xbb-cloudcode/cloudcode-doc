(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{431:function(t,s,a){"use strict";a.r(s);var n=a(56),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"云函数环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云函数环境"}},[t._v("#")]),t._v(" 云函数环境")]),t._v(" "),a("blockquote",[a("p",[t._v("云函数是运行在阿里云函数计算服务上的，目前仅支持nodejs12(Node.js 12.16.1)的运行环境。")])]),t._v(" "),a("h2",{attrs:{id:"返回信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#返回信息"}},[t._v("#")]),t._v(" 返回信息")]),t._v(" "),a("p",[t._v("Node.js采用异步编程的模型，您的函数需要使用callback入参返回信息。callback的语法如下所示。\n"),a("code",[t._v("callback(Error error, Object result);")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("error")]),t._v(" "),a("td",[t._v("在函数执行内部失败时使用此参数返回错误内容，成功情况下设置为null。")])]),t._v(" "),a("tr",[a("td",[t._v("result")]),t._v(" "),a("td",[t._v("使用此参数返回函数成功的执行结果。result可以是任意类型，函数计算会将其序列化成字节流，放到响应体中返回给调用方。")])])])]),t._v(" "),a("ul",[a("li",[t._v("callback被调用后则函数结束\ncallback被调用后函数就会停止运行，重复调用callback只接受第一次调用的结果。需要确保所有任务在callback调用之前完成，否则有些任务可能不会被运行。例如调用下面的函数，将返回hello world，并且message不会被打印。")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'done'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     \n")])])]),a("ul",[a("li",[t._v("callback未被调用则函数超时\n如果在函数中没有调用callback，则系统将认为函数没有结束，会等待函数结果直到超时。")])]),t._v(" "),a("h2",{attrs:{id:"使用内置模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用内置模块"}},[t._v("#")]),t._v(" 使用内置模块")]),t._v(" "),a("p",[t._v("除了Node.js的标准模块，函数计算的Node.js运行环境中还包含了一些常用模块，您可以直接引用这些常用模块，目前函数计算包含的常见模块如下所示。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("版本")]),t._v(" "),a("th",[t._v("模块介绍")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("co")]),t._v(" "),a("td",[t._v("4.6.0")]),t._v(" "),a("td",[t._v("控制流")])]),t._v(" "),a("tr",[a("td",[t._v("gm")]),t._v(" "),a("td",[t._v("1.23.0")]),t._v(" "),a("td",[t._v("图片处理库")])]),t._v(" "),a("tr",[a("td",[t._v("ali-oss")]),t._v(" "),a("td",[t._v("4.10.1")]),t._v(" "),a("td",[t._v("OSS SDK")])]),t._v(" "),a("tr",[a("td",[t._v("ali-mns")]),t._v(" "),a("td",[t._v("2.6.5")]),t._v(" "),a("td",[t._v("MNS SDK")])]),t._v(" "),a("tr",[a("td",[t._v("tablestore")]),t._v(" "),a("td",[t._v("4.2.0")]),t._v(" "),a("td",[t._v("OTS SDK")])]),t._v(" "),a("tr",[a("td",[t._v("aliyun-sdk")]),t._v(" "),a("td",[t._v("1.10.12")]),t._v(" "),a("td",[t._v("Aliyun SDK")])]),t._v(" "),a("tr",[a("td",[t._v("opencv")]),t._v(" "),a("td",[t._v("6.0.0")]),t._v(" "),a("td",[t._v("视觉算法库")])])])]),t._v(" "),a("h2",{attrs:{id:"使用自定义模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义模块"}},[t._v("#")]),t._v(" 使用自定义模块")]),t._v(" "),a("p",[t._v("如果您需要使用自定义模块，则需要将您的自定义模块与代码一起打包上传。您可以使用npm包管理器进行依赖管理。打包时，需要针对文件进行打包，而不是针对代码整体目录进行打包。打包完成后，入口函数(index.js)文件需要位于包内的根目录。")]),t._v(" "),a("ul",[a("li",[t._v("在Windows下打包时，可以进入函数代码目录，全选所有文件以后，单击鼠标右键，选择压缩为zip包，生成代码包。")]),t._v(" "),a("li",[t._v("在Linux下打包时，通过调用zip命令时，将源文件指定为代码目录下的所有文件，实现生成部署代码包，例如zip code.zip /home/code/*。")])]),t._v(" "),a("h2",{attrs:{id:"调用外部命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用外部命令"}},[t._v("#")]),t._v(" 调用外部命令")]),t._v(" "),a("p",[t._v("您的函数可能会用到一些工具，而这些工具并不是用Node.js写的。例如，Shell、C++ 或者Go编译出来的可执行文件。您仍然可以将这些工具与代码一起打包，然后在函数中通过运行外部命令的方法来使用它们。以下代码演示了如何运行一个Shell脚本。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" exec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'child_process'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" scriptPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FC_FUNC_CODE_PATH'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/script.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bash '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("scriptPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stderr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stderr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);